<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Baseball Strategy Master â€” Local Preview</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    #root { min-height: 100vh; }

    /* Mobile-first responsive styles */
    @media (max-width: 480px) {
      button { min-height: 48px !important; font-size: 14px !important; }
      #root > div > div { padding-left: 8px !important; padding-right: 8px !important; }
    }
    @media (min-width: 481px) and (max-width: 768px) {
      #root > div > div { max-width: 600px; margin: 0 auto; }
    }
    @media (min-width: 769px) {
      #root > div > div { max-width: 480px; margin: 0 auto; }
    }
    /* Ensure touch targets are large enough */
    button, [role="button"] {
      min-height: 44px;
      touch-action: manipulation;
    }
    /* Prevent zoom on double-tap on iOS */
    input, select, textarea { font-size: 16px; }
    /* Safe area for notch devices */
    @supports (padding: env(safe-area-inset-bottom)) {
      body { padding-bottom: env(safe-area-inset-bottom); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script>
    // Polyfill window.storage (Claude.ai artifact API) with localStorage
    window.storage = {
      get: async (key) => {
        const value = localStorage.getItem(key);
        return value !== null ? { value } : null;
      },
      set: async (key, value) => {
        localStorage.setItem(key, value);
      }
    };

    // Show errors visually
    function showError(title, detail) {
      document.getElementById('root').innerHTML =
        '<div style="padding:40px;color:red;font-size:16px;max-width:700px;margin:0 auto">' +
        '<h2>' + title + '</h2>' +
        '<pre style="margin-top:12px;background:#1a1a2e;color:#ff6b6b;padding:16px;border-radius:8px;overflow-x:auto;font-size:13px;white-space:pre-wrap">' +
        detail + '</pre></div>';
    }

    // Fetch index.jsx, transpile with Babel, and mount the App
    fetch('./index.jsx')
      .then(r => {
        if (!r.ok) throw new Error('HTTP ' + r.status + ': ' + r.statusText);
        return r.text();
      })
      .then(code => {
        // Replace the ES module import with destructuring from the global React
        code = code.replace(
          /import\s*\{[^}]*\}\s*from\s*["']react["'];?/,
          'const { useState, useEffect, useCallback, useRef } = React;'
        );
        // Replace "export default function App" with just "function App"
        code = code.replace('export default function App', 'function App');

        // Add the ReactDOM render call at the end
        code += '\nReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));';

        try {
          var transformed = Babel.transform(code, {
            presets: ['react', ['env', { targets: { browsers: ['last 2 Chrome versions'] } }]],
            filename: 'index.jsx'
          }).code;
        } catch (e) {
          showError('Babel Transform Error', e.message);
          return;
        }

        try {
          var script = document.createElement('script');
          script.textContent = transformed;
          document.body.appendChild(script);
        } catch (e) {
          showError('Runtime Error', e.message + '\n\n' + e.stack);
        }
      })
      .catch(err => {
        showError('Failed to load index.jsx',
          err.message + '\n\nMake sure you are running a local server.\n' +
          'From this folder run: npx serve .\n' +
          'Then open: http://localhost:3000/preview.html');
      });

    // Catch runtime errors that happen after script load
    window.addEventListener('error', function(e) {
      if (document.getElementById('root').children.length === 0) {
        showError('Runtime Error', e.message + ' (line ' + e.lineno + ')');
      }
    });
  </script>
</body>
</html>
